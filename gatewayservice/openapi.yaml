openapi: 3.0.3
info:
  title: Wichat Gateway Service API
  description: |
    This API serves as the main entry point for the Wichat application, acting as a gateway to authentication, user, LLM, game and shared quiz services.
    All requests from the webapp and external clients should be routed through this gateway.
  version: 1.0.0
  contact:
    name: Wichat Team
    url: https://github.com/arquisoft/wichat_en2b

servers:
  - url: http://localhost:8000
    description: Local development server
  - url: https://wichat.ddns.net/gateway
    description: Deployed server

tags:
  - name: Authentication
    description: Endpoints for user authentication and 2FA
  - name: Users
    description: Endpoints for user management
  - name: Groups
    description: Endpoints for group management and interactions
  - name: LLM
    description: Endpoints for Large Language Model interactions
  - name: Game
    description: Endpoints for quiz and game features
  - name: SharedQuiz
    description: Endpoints for shared quiz session management

paths:
  /login:
    post:
      tags: [Authentication]
      summary: User login
      description: Authenticates a user and returns a JWT token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  example: johndoe
                password:
                  type: string
                  example: mypassword
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
        '401':
          description: Invalid credentials

  /adduser:
    post:
      tags: [Authentication]
      summary: Register a new user
      description: Registers a new user and returns a JWT token. Used for self-service user signup
        via the webapp or external clients.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: johndoe
                password:
                  type: string
                  example: mypassword
                role:
                  type: string
                  enum: [USER, ADMIN]
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
        '400':
          description: Validation error

  /setup2fa:
    post:
      tags: [Authentication]
      summary: Set up 2FA for a user
      description: Initiates two-factor authentication setup for the user, returning a QR code URL for authenticator app setup..
      security:
        - bearerAuth: [ ]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: 2FA initialized successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  imageUrl:
                    type: string
                    description: Base64-encoded QR code URL for 2FA setup
                    example: data:image/png;base64,iVBORw0KGgo...
        '401':
          description: Unauthorized - Invalid or missing JWT token
        '500':
          description: Internal server error (e.g., QR code generation failed)

  /verify2fa:
    post:
      tags: [Authentication]
      summary: Verify 2FA token
      description: Verifies a 2FA token for a user, returning a JWT token upon successful verification.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token, user]
              properties:
                token:
                  type: string
                  description: The 2FA code from the authenticator app
                user:
                  type: object
                  required: [ username ]
                  properties:
                    username:
                      type: string
                      description: The username of the user verifying 2FA
                      example: johndoe
      responses:
        '200':
          description: 2FA verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Confirmation message
                    example: 2FA Verified
                  token:
                    type: string
                    description: JWT token for authenticated session
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '400':
          description: Invalid request (e.g., missing token or user)
        '401':
          description: Invalid 2FA token
        '500':
          description: Internal server error (e.g., user service unavailable)
  /check2fa:
    get:
      tags: [ Authentication ]
      summary: Check 2FA status
      description: Checks if 2FA is enabled for the authenticated user.
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: 2FA status
          content:
            application/json:
              schema:
                type: object
                properties:
                  twoFactorEnabled:
                    type: boolean
                    example: true
                  user_id:
                    type: string
                    example: 123abc
        '401':
          description: Unauthorized - Invalid or missing JWT token
        '500':
          description: Internal server error

  /token/username:
    get:
      tags: [ Authentication ]
      summary: Get username from token
      description: Retrieves the username associated with a JWT token.
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: User details retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized - Invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
             application/json:
               schema:
                 $ref: '#/components/schemas/Error'
        '500':
           description: Internal server error
           content:
             application/json:
               schema:
                 $ref: '#/components/schemas/Error'

  /users:
    get:
      tags: [ Users ]
      summary: Get all users
      description: Retrieves a list of all users.
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      tags: [ Users ]
      summary: Create a new user
      description: Creates a new user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
                role:
                  type: string
                  enum: [ USER, ADMIN ]
              required: [ username, password ]
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid request (e.g., username exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      tags: [ Users ]
      summary: Update user
      description: Updates authenticated user's details (username, password, profile picture, or 2FA secret).
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newUsername:
                  type: string
                  description: New username
                oldPassword:
                  type: string
                  description: Current password for verification
                newPassword:
                  type: string
                  description: New password
                profilePicture:
                  type: string
                  description: Profile picture URL or empty string
                secret:
                  type: string
                  description: 2FA secret or empty string
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User updated successfully
        '400':
          description: Invalid request (e.g., invalid password, username taken)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - Invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Username already taken
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: Database unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags: [ Users ]
      summary: Delete user
      description: Deletes the authenticated user.
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: User deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User deleted successfully
        '401':
          description: Unauthorized - Invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/{username}:
    get:
      tags: [ Users ]
      summary: Get user by username
      description: Retrieves a user by their username.
      parameters:
        - in: path
          name: username
          required: true
          schema:
            type: string
          description: Username of the user
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/id/{id}:
    get:
      tags: [ Users ]
      summary: Get user by ID
      description: Retrieves a user by their ID.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the user
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/by-ids:
    post:
      tags: [ Users ]
      summary: Get users by IDs
      description: Retrieves multiple users by their MongoDB ObjectIds.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                users:
                  type: array
                  items:
                    type: string
                  example: [ "65fab123456789abcdef1234", "65fab123456789abcdef5678" ]
              required: [ users ]
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '400':
          description: Invalid request (e.g., missing or invalid users array)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/profile/picture:
    post:
      tags: [ Users ]
      summary: Upload profile picture
      description: Uploads a profile picture for the authenticated user.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ image ]
              properties:
                image:
                  type: string
                  description: Base64-encoded image (JPEG, PNG, or WebP)
      responses:
        '200':
          description: Profile picture uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  profilePicture:
                    type: string
                    description: Path to the uploaded image
                    example: images/65fab123456789abcdef1234_profile_picture.webp
        '400':
          description: Invalid request (e.g., no image, invalid file type)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - Invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/profile/picture/{id}:
    get:
      tags: [ Users ]
      summary: Get profile picture URL
      description: Retrieves the profile picture URL for a user by their ID.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: MongoDB ObjectId of the user
      responses:
        '200':
          description: Profile picture URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  profilePicture:
                    type: string
                    description: Path to the profile picture or empty string
                    example: images/65fab123456789abcdef1234_profile_picture.webp
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /askllm:
    post:
      tags: [ LLM ]
      summary: Ask a question to the LLM
      description: Sends a question to the LLM service and returns the answer.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ conversation, model, possibleAnswers ]
              properties:
                conversation:
                  type: array
                  items:
                    type: object
                    properties:
                      role:
                        type: string
                        example: user
                      content:
                        type: string
                        description: The question or prompt for the LLM
                    required: [ role, content ]
                  description: Array of conversation messages
                model:
                  type: string
                  description: The LLM model to use
                  example: empathy
                possibleAnswers:
                  type: string
                  description: Possible answers or context for the LLM
      responses:
        '200':
          description: LLM response
          content:
            application/json:
              schema:
                type: object
                properties:
                  role:
                    type: string
                    example: assistant
                  content:
                    type: string
                    description: The LLM's response
                required: [ role, content ]
        '400':
          description: Invalid request (e.g., missing required fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error (e.g., LLM failure)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /quiz:
    get:
      tags: [ Game ]
      summary: Get all quizzes
      description: Retrieves all available quizzes.
      responses:
        '200':
          description: List of quizzes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Quiz'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      tags: [ Game ]
      summary: Create a quiz
      description: Creates a new quiz with Wikidata query and saves it to the database.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Quiz'
      responses:
        '201':
          description: Quiz created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quiz'
        '204':
          description: No items found for the Wikidata query
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No items where found with that query, not saving the category.
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /quiz/allTopics:
    get:
      tags: [ Game ]
      summary: Get all quiz topics
      description: Retrieves all unique quiz topics.
      responses:
        '200':
          description: List of topics
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                  example: History
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /quiz/{topic}:
    get:
      tags: [ Game ]
      summary: Get quizzes by topic
      description: Retrieves all quizzes for a specific topic.
      parameters:
        - in: path
          name: topic
          required: true
          schema:
            type: string
          description: Quiz topic (category)
      responses:
        '200':
          description: List of quizzes for the topic
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Quiz'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /groups:
    get:
      tags: [ Groups ]
      summary: Get all groups
      description: Retrieves a list of all groups.
      responses:
        '200':
          description: List of groups
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Group'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      tags: [ Groups ]
      summary: Create a group
      description: Creates a new group with the authenticated user as owner and member.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ name ]
              properties:
                name:
                  type: string
                  example: MyGroup
      responses:
        '200':
          description: Group created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '400':
          description: Invalid request (e.g., missing name, group exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      tags: [ Groups ]
      summary: Update group name
      description: Updates the name of the group if the authenticated user is the owner.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ name ]
              properties:
                name:
                  type: string
                  example: MyGroup
      responses:
        '200':
          description: Group updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '400':
          description: Invalid request (e.g., missing name, name exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - User is not the owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags: [ Groups ]
      summary: Delete group
      description: Deletes the group if the authenticated user is the owner.
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Group deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Group deleted successfully
                  group:
                    $ref: '#/components/schemas/Group'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - User is not the owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /groups/{groupName}:
    get:
      tags: [ Groups ]
      summary: Get group by name
      description: Retrieves a group by its name.
      parameters:
        - in: path
          name: groupName
          required: true
          schema:
            type: string
          description: Group name
      responses:
        '200':
          description: Group details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '204':
          description: Group not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /groups/joined:
    get:
      tags: [ Groups ]
      summary: Get joined group
      description: Retrieves the group the authenticated user has joined.
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Joined group
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '204':
          description: No group joined
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /groups/join:
    post:
      tags: [ Groups ]
      summary: Join a group
      description: Allows an authenticated user to join a group.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ name ]
              properties:
                name:
                  type: string
                  example: MyGroup
      responses:
        '200':
          description: Joined group
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Joined group successfully
                  group:
                    $ref: '#/components/schemas/Group'
        '400':
          description: Invalid request (e.g., missing name, already in group)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /groups/leave:
    post:
      tags: [ Groups ]
      summary: Leave a group
      description: Allows an authenticated user to leave their current group.
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Left group
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Left the group successfully
                  group:
                    $ref: '#/components/schemas/Group'
        '400':
          description: Invalid request (e.g., not in a group)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /game:
    post:
      tags: [ Game ]
      summary: Store game information
      description: Stores game session infromation for the authenticated user.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ subject, points_gain, number_of_questions, number_correct_answers, total_time ]
              properties:
                subject:
                  type: string
                  example: History
                points_gain:
                  type: number
                  example: 100
                number_of_questions:
                  type: integer
                  example: 10
                number_correct_answers:
                  type: integer
                  example: 4
                total_time:
                  type: number
                  example: 55.5
      responses:
        '201':
          description: Game session created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameInfo'
        '400':
          description: Invalid request (e.g., missing fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /game/{subject}/{totalQuestions}/{numberOptions}:
    get:
      tags: [ Game ]
      summary: Get game questions
      description: Retrieves random questions for a game based on subject, number of questions, and answer options.
      parameters:
        - in: path
          name: subject
          required: true
          schema:
            type: string
          description: Subject of the game
        - in: path
          name: totalQuestions
          required: false
          schema:
            type: integer
            default: 3
          description: Number of questions
        - in: path
          name: numberOptions
          required: false
          schema:
            type: integer
            default: 3
          description: Number of answer options per question
      responses:
        '200':
          description: Game questions
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    question_id:
                      type: string
                      description: Unique question identifier
                    image_name:
                      type: string
                      description: Path to question image
                      example: /images/65fab123456789abcdef1234.jpg
                    answers:
                      type: array
                      items:
                        type: string
                      description: Shuffled answer options including correct answer
                  required: [ question_id, image_name, answers ]
        '400':
          description: Not enough questions available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /question/validate:
    post:
      tags: [ Game ]
      summary: Validate question answer
      description: Validates a user's answer to a quiz question
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ question_id, selected_answer ]
              properties:
                questionId:
                  type: string
                  example: q123...
                answer:
                  type: string
                  example: Answer1
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  correct:
                    type: boolean
                    example: true
        '404':
          description: Question not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /question/amount/{code}:
    get:
      tags: [ Game ]
      summary: Get question amount
      description: Retrieves the number of questions for a quiz subject.
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
          description: Quiz subject code
      responses:
        '200':
          description: Question amount
          content:
            application/json:
              schema:
                type: integer
                example: 10
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /statistics/recent-quizzes:
    get:
      tags: [ Game ]
      summary: Get recent quizzes
      description: Retrieves a paginated list of recent quizzes for the authenticated user.
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
          description: Page number for pagination
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: List of recent quizzes
          content:
            application/json:
              schema:
                type: object
                properties:
                  recentQuizzes:
                    type: array
                    items:
                      $ref: '#/components/schemas/GameInfo'
                  hasMoreQuizzes:
                    type: boolean
                    description: Indicates if more quizzes are available
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /statistics/subject/{subject}:
    get:
      tags: [ Game ]
      summary: Get subject statistics
      description: Retrieves statistics for a specific subject for the authenticated user.
      parameters:
        - in: path
          name: subject
          required: true
          schema:
            type: string
          description: Subject name
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Subject statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  subject:
                    type: string
                    example: History
                  stats:
                    type: object
                    properties:
                      totalGames:
                        type: integer
                        example: 100
                      avgScore:
                        type: number
                        example: 75.5
                      totalScore:
                        type: number
                        example: 7550
                      totalCorrectAnswers:
                        type: integer
                        example: 400
                      totalQuestions:
                        type: integer
                        example: 500
                      avgTime:
                        type: number
                        example: 55.5
                      successRatio:
                        type: number
                        example: 0.8
                    nullable: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /statistics/global:
    get:
      tags: [ Game ]
      summary: Get global statistics
      description: Retrieves global quiz statistics for the authenticated user.
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Global statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  stats:
                    type: object
                    properties:
                      totalGames:
                        type: integer
                        example: 1000
                      avgScore:
                        type: number
                        example: 68.5
                      totalScore:
                        type: number
                        example: 6850
                      totalCorrectAnswers:
                        type: integer
                        example: 4000
                      totalQuestions:
                        type: integer
                        example: 5000
                      avgTime:
                        type: number
                        example: 50.5
                      successRatio:
                        type: number
                        example: 0.8
                    nullable: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /leaderboard:
    get:
      tags: [ Game ]
      summary: Get global leaderboard
      description: Retrieves the top 10 players and the authenticated user, ranked by total score.
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: Leaderboard
          content:
            application/json:
              schema:
                type: object
                properties:
                  leaderboard:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          description: User ID
                        totalScore:
                          type: number
                          example: 950
                        totalGames:
                          type: integer
                          example: 10
                        avgScore:
                          type: number
                          example: 95
                        rank:
                          type: integer
                          example: 1
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /leaderboard/group:
    post:
      tags: [ Game ]
      summary: Get group leaderboard
      description: Retrieves the leaderboard for a specific group of players.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ players ]
              properties:
                players:
                  type: array
                  items:
                    type: string
                  description: Array of user IDs
                  example: [ "user123", "user456" ]
      responses:
        '200':
          description: Group leaderboard
          content:
            application/json:
              schema:
                type: object
                properties:
                  leaderboard:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          description: User ID
                        totalScore:
                          type: number
                          example: 950
                        totalGames:
                          type: integer
                          example: 10
                        avgScore:
                          type: number
                          example: 95
                        rank:
                          type: integer
                          example: 1
        '400':
          description: Invalid request (e.g., missing players array)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /shared-quiz/create:
    post:
      tags: [ SharedQuiz ]
      summary: Create a shared quiz session
      description: Creates a new shared quiz session.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ hostId, hostUsername, quizData, quizMetaData ]
              properties:
                hostId:
                  type: string
                  example: 65fab123456789abcdef1234
                hostUsername:
                  type: string
                  example: user1
                quizData:
                  type: array
                  items:
                    type: object
                    properties:
                      question:
                        type: string
                      answers:
                        type: array
                        items:
                          type: string
                      correctAnswer:
                        type: string
                  description: Array of quiz questions
                quizMetaData:
                  type: array
                  items:
                    type: object
                    properties:
                      timePerQuestion:
                        type: number
                        example: 30
                  description: Quiz metadata (e.g., time per question)
      responses:
        '201':
          description: Shared quiz session created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  code:
                    type: string
                    example: ABC123
                  sessionId:
                    type: string
                    example: 65fab123456789abcdef1234
        '400':
          description: Invalid request (e.g., missing fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /shared-quiz/{code}/join:
    post:
      tags: [ SharedQuiz ]
      summary: Join a shared quiz session
      description: Allows a user to join a shared quiz session.
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
          description: Quiz session code
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ playerId, username ]
              properties:
                playerId:
                  type: string
                  example: 65fab123456789abcdef5678
                username:
                  type: string
                  example: user2
      responses:
        '200':
          description: Joined shared quiz session
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  sessionId:
                    type: string
                    example: 65fab123456789abcdef1234
                  players:
                    type: array
                    items:
                      $ref: '#/components/schemas/Player'
        '400':
          description: Invalid request (e.g., missing fields, session started)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /shared-quiz/{code}/start:
    get:
      tags: [ SharedQuiz ]
      summary: Start a shared quiz session
      description: Starts a shared quiz session (host only).
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
          description: Quiz session code
        - in: query
          name: hostId
          required: true
          schema:
            type: string
          description: Host user ID
      responses:
        '200':
          description: Shared quiz started
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  status:
                    type: string
                    example: active
                  currentQuestionIndex:
                    type: integer
                    example: 0
        '400':
          description: Invalid request (e.g., missing hostId)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - Not the host
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /shared-quiz/{code}/next:
    get:
      tags: [ SharedQuiz ]
      summary: Move to next question
      description: Advances to the next question in a shared quiz session (host only).
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
          description: Quiz session code
        - in: query
          name: hostId
          required: true
          schema:
            type: string
          description: Host user ID
      responses:
        '200':
          description: Moved to next question
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  currentQuestionIndex:
                    type: integer
                    example: 1
        '400':
          description: Invalid request (e.g., missing hostId)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - Not the host
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /shared-quiz/{code}/end:
    get:
      tags: [ SharedQuiz ]
      summary: End a shared quiz session
      description: Ends a shared quiz session (host only).
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
          description: Quiz session code
        - in: query
          name: hostId
          required: true
          schema:
            type: string
          description: Host user ID
      responses:
        '200':
          description: Shared quiz ended
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  status:
                    type: string
                    example: ended
                  players:
                    type: array
                    items:
                      $ref: '#/components/schemas/Player'
        '400':
          description: Invalid request (e.g., missing hostId)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - Not the host
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /shared-quiz/{code}/status:
    get:
      tags: [ SharedQuiz ]
      summary: Get shared quiz session status
      description: Retrieves the current status of a shared quiz session.
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
          description: Quiz session code
        - in: query
          name: playerId
          required: false
          schema:
            type: string
          description: Player ID for authorization check
      responses:
        '200':
          description: Session status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [ waiting, active, ended ]
                    example: active
                  currentQuestionIndex:
                    type: integer
                    example: 2
                  waitingForNext:
                    type: boolean
                    example: false
                  players:
                    type: array
                    items:
                      $ref: '#/components/schemas/Player'
        '403':
          description: Forbidden - Player not in session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /shared-quiz/{code}/answer:
    post:
      tags: [ SharedQuiz ]
      summary: Submit answer for shared quiz
      description: Submits an answer for a question in a shared quiz session.
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
          description: Quiz session code
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ playerId, questionId, answerId, isCorrect, timeToAnswer ]
              properties:
                playerId:
                  type: string
                  example: 65fab123456789abcdef5678
                questionId:
                  type: string
                  example: 65fab123456789abcdef1234
                answerId:
                  type: string
                  description: Identifier of the selected answer
                isCorrect:
                  type: boolean
                  example: true
                timeToAnswer:
                  type: number
                  example: 10.5
                rightAnswer:
                  type: string
                  description: Correct answer
                answer:
                  type: string
                  example: Answer1
      responses:
        '200':
          description: Answer submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  score:
                    type: number
                    example: 100
        '400':
          description: Invalid request (e.g., missing fields, session not active)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Session or player not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    User:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
        role:
          type: string
          enum: [USER, ADMIN]
    Quiz:
      type: object
      properties:
        topic:
          type: string
        questions:
          type: array
          items:
            $ref: '#/components/schemas/Question'
    Question:
      type: object
      properties:
        question:
          type: string
        answers:
          type: array
          items:
            type: string
        correctAnswer:
          type: string

    Group:
      type: object
      properties:
        groupName:
          type: string
          description: Name of the group
          example: mygroup
        owner:
          type: string
          description: ID of the user who owns the group
        members:
          type: array
          description: List of user IDs who are members of the group
          items:
            type: string
          example: [ "6807b...", "680d5..." ]
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the group was created
          example: 2025-04-24T19:28:37.303Z

    GameInfo:
      type: object
      properties:
        _id:
          type: string
          description: Unique game session identifier
        user_id:
          type: string
          description: User ID of the player
        subject:
          type: string
          example: History
        points_gain:
          type: number
          example: 100
        number_of_questions:
          type: integer
          example: 10
        number_correct_answers:
          type: integer
          example: 4
        total_time:
          type: number
          example: 55.5
        createdAt:
          type: string
          format: date-time
          description: Game creation timestamp
      required: [ user_id, subject, points_gain, number_of_questions, number_correct_answers, total_time ]
    Player:
        type: object
        properties:
          id:
            type: string
            example: 65fab123456789abcdef5678
          username:
            type: string
            example: user2
          score:
            type: number
            example: 100
          answers:
            type: array
            items:
              type: object
              properties:
                questionId:
                  type: string
                answerId:
                  type: string
                isCorrect:
                  type: boolean
                timeToAnswer:
                  type: number
                rightAnswer:
                  type: string
                answer:
                  type: string
          total_time:
            type: number
            example: 50.5
        required: [ id, username, score, answers ]
    Error:
      type: object
      properties:
        error:
          type: string
          description: Human-readable error message
      example:
        error: Unauthorized